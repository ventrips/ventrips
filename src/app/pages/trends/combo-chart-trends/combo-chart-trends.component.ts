import { Component, OnInit, ViewChild } from '@angular/core';
import { ChartDataSets, ChartOptions } from 'chart.js';
import { Color, BaseChartDirective, Label } from 'ng2-charts';
import * as pluginAnnotations from 'chartjs-plugin-annotation';
import * as _ from 'lodash';
import * as moment from 'moment';

@Component({
  selector: 'app-combo-chart-trends',
  templateUrl: './combo-chart-trends.component.html',
  styleUrls: ['./combo-chart-trends.component.scss']
})
export class ComboChartTrendsComponent implements OnInit {
  public data = {
    "googleTrends": [
        [
            "Time",
            "msft stock: (United States)"
        ],
        [
            "2019-09-14T17:24:00+03:00",
            "20"
        ],
        [
            "2019-09-14T17:32:00+03:00",
            "29"
        ],
        [
            "2019-09-14T17:40:00+03:00",
            "28"
        ],
        [
            "2019-09-14T17:48:00+03:00",
            "46"
        ],
        [
            "2019-09-14T17:56:00+03:00",
            "18"
        ],
        [
            "2019-09-14T18:04:00+03:00",
            "31"
        ],
        [
            "2019-09-14T18:12:00+03:00",
            "17"
        ],
        [
            "2019-09-14T18:20:00+03:00",
            "13"
        ],
        [
            "2019-09-14T18:28:00+03:00",
            "30"
        ],
        [
            "2019-09-14T18:36:00+03:00",
            "42"
        ],
        [
            "2019-09-14T18:44:00+03:00",
            "34"
        ],
        [
            "2019-09-14T18:52:00+03:00",
            "29"
        ],
        [
            "2019-09-14T19:00:00+03:00",
            "20"
        ],
        [
            "2019-09-14T19:08:00+03:00",
            "12"
        ],
        [
            "2019-09-14T19:16:00+03:00",
            "16"
        ],
        [
            "2019-09-14T19:24:00+03:00",
            "20"
        ],
        [
            "2019-09-14T19:32:00+03:00",
            "19"
        ],
        [
            "2019-09-14T19:40:00+03:00",
            "8"
        ],
        [
            "2019-09-14T19:48:00+03:00",
            "7"
        ],
        [
            "2019-09-14T19:56:00+03:00",
            "11"
        ],
        [
            "2019-09-14T20:04:00+03:00",
            "8"
        ],
        [
            "2019-09-14T20:12:00+03:00",
            "11"
        ],
        [
            "2019-09-14T20:20:00+03:00",
            "19"
        ],
        [
            "2019-09-14T20:28:00+03:00",
            "11"
        ],
        [
            "2019-09-14T20:36:00+03:00",
            "19"
        ],
        [
            "2019-09-14T20:44:00+03:00",
            "11"
        ],
        [
            "2019-09-14T20:52:00+03:00",
            "15"
        ],
        [
            "2019-09-14T21:00:00+03:00",
            "0"
        ],
        [
            "2019-09-14T21:08:00+03:00",
            "7"
        ],
        [
            "2019-09-14T21:16:00+03:00",
            "15"
        ],
        [
            "2019-09-14T21:24:00+03:00",
            "25"
        ],
        [
            "2019-09-14T21:32:00+03:00",
            "26"
        ],
        [
            "2019-09-14T21:40:00+03:00",
            "4"
        ],
        [
            "2019-09-14T21:48:00+03:00",
            "15"
        ],
        [
            "2019-09-14T21:56:00+03:00",
            "18"
        ],
        [
            "2019-09-14T22:04:00+03:00",
            "18"
        ],
        [
            "2019-09-14T22:12:00+03:00",
            "15"
        ],
        [
            "2019-09-14T22:20:00+03:00",
            "4"
        ],
        [
            "2019-09-14T22:28:00+03:00",
            "7"
        ],
        [
            "2019-09-14T22:36:00+03:00",
            "29"
        ],
        [
            "2019-09-14T22:44:00+03:00",
            "22"
        ],
        [
            "2019-09-14T22:52:00+03:00",
            "7"
        ],
        [
            "2019-09-14T23:00:00+03:00",
            "29"
        ],
        [
            "2019-09-14T23:08:00+03:00",
            "7"
        ],
        [
            "2019-09-14T23:16:00+03:00",
            "15"
        ],
        [
            "2019-09-14T23:24:00+03:00",
            "4"
        ],
        [
            "2019-09-14T23:32:00+03:00",
            "29"
        ],
        [
            "2019-09-14T23:40:00+03:00",
            "4"
        ],
        [
            "2019-09-14T23:48:00+03:00",
            "14"
        ],
        [
            "2019-09-14T23:56:00+03:00",
            "22"
        ],
        [
            "2019-09-15T00:04:00+03:00",
            "22"
        ],
        [
            "2019-09-15T00:12:00+03:00",
            "18"
        ],
        [
            "2019-09-15T00:20:00+03:00",
            "0"
        ],
        [
            "2019-09-15T00:28:00+03:00",
            "18"
        ],
        [
            "2019-09-15T00:36:00+03:00",
            "26"
        ],
        [
            "2019-09-15T00:44:00+03:00",
            "7"
        ],
        [
            "2019-09-15T00:52:00+03:00",
            "26"
        ],
        [
            "2019-09-15T01:00:00+03:00",
            "26"
        ],
        [
            "2019-09-15T01:08:00+03:00",
            "7"
        ],
        [
            "2019-09-15T01:16:00+03:00",
            "4"
        ],
        [
            "2019-09-15T01:24:00+03:00",
            "18"
        ],
        [
            "2019-09-15T01:32:00+03:00",
            "18"
        ],
        [
            "2019-09-15T01:40:00+03:00",
            "18"
        ],
        [
            "2019-09-15T01:48:00+03:00",
            "4"
        ],
        [
            "2019-09-15T01:56:00+03:00",
            "4"
        ],
        [
            "2019-09-15T02:04:00+03:00",
            "14"
        ],
        [
            "2019-09-15T02:12:00+03:00",
            "29"
        ],
        [
            "2019-09-15T02:20:00+03:00",
            "18"
        ],
        [
            "2019-09-15T02:28:00+03:00",
            "11"
        ],
        [
            "2019-09-15T02:36:00+03:00",
            "14"
        ],
        [
            "2019-09-15T02:44:00+03:00",
            "14"
        ],
        [
            "2019-09-15T02:52:00+03:00",
            "11"
        ],
        [
            "2019-09-15T03:00:00+03:00",
            "4"
        ],
        [
            "2019-09-15T03:08:00+03:00",
            "22"
        ],
        [
            "2019-09-15T03:16:00+03:00",
            "18"
        ],
        [
            "2019-09-15T03:24:00+03:00",
            "4"
        ],
        [
            "2019-09-15T03:32:00+03:00",
            "11"
        ],
        [
            "2019-09-15T03:40:00+03:00",
            "25"
        ],
        [
            "2019-09-15T03:48:00+03:00",
            "11"
        ],
        [
            "2019-09-15T03:56:00+03:00",
            "19"
        ],
        [
            "2019-09-15T04:04:00+03:00",
            "11"
        ],
        [
            "2019-09-15T04:12:00+03:00",
            "11"
        ],
        [
            "2019-09-15T04:20:00+03:00",
            "11"
        ],
        [
            "2019-09-15T04:28:00+03:00",
            "4"
        ],
        [
            "2019-09-15T04:36:00+03:00",
            "22"
        ],
        [
            "2019-09-15T04:44:00+03:00",
            "4"
        ],
        [
            "2019-09-15T04:52:00+03:00",
            "22"
        ],
        [
            "2019-09-15T05:00:00+03:00",
            "27"
        ],
        [
            "2019-09-15T05:08:00+03:00",
            "23"
        ],
        [
            "2019-09-15T05:16:00+03:00",
            "8"
        ],
        [
            "2019-09-15T05:24:00+03:00",
            "24"
        ],
        [
            "2019-09-15T05:32:00+03:00",
            "12"
        ],
        [
            "2019-09-15T05:40:00+03:00",
            "12"
        ],
        [
            "2019-09-15T05:48:00+03:00",
            "12"
        ],
        [
            "2019-09-15T05:56:00+03:00",
            "25"
        ],
        [
            "2019-09-15T06:04:00+03:00",
            "26"
        ],
        [
            "2019-09-15T06:12:00+03:00",
            "13"
        ],
        [
            "2019-09-15T06:20:00+03:00",
            "41"
        ],
        [
            "2019-09-15T06:28:00+03:00",
            "24"
        ],
        [
            "2019-09-15T06:36:00+03:00",
            "10"
        ],
        [
            "2019-09-15T06:44:00+03:00",
            "25"
        ],
        [
            "2019-09-15T06:52:00+03:00",
            "26"
        ],
        [
            "2019-09-15T07:00:00+03:00",
            "26"
        ],
        [
            "2019-09-15T07:08:00+03:00",
            "0"
        ],
        [
            "2019-09-15T07:16:00+03:00",
            "17"
        ],
        [
            "2019-09-15T07:24:00+03:00",
            "18"
        ],
        [
            "2019-09-15T07:32:00+03:00",
            "19"
        ],
        [
            "2019-09-15T07:40:00+03:00",
            "19"
        ],
        [
            "2019-09-15T07:48:00+03:00",
            "7"
        ],
        [
            "2019-09-15T07:56:00+03:00",
            "29"
        ],
        [
            "2019-09-15T08:04:00+03:00",
            "22"
        ],
        [
            "2019-09-15T08:12:00+03:00",
            "31"
        ],
        [
            "2019-09-15T08:20:00+03:00",
            "49"
        ],
        [
            "2019-09-15T08:28:00+03:00",
            "9"
        ],
        [
            "2019-09-15T08:36:00+03:00",
            "27"
        ],
        [
            "2019-09-15T08:44:00+03:00",
            "9"
        ],
        [
            "2019-09-15T08:52:00+03:00",
            "29"
        ],
        [
            "2019-09-15T09:00:00+03:00",
            "10"
        ],
        [
            "2019-09-15T09:08:00+03:00",
            "20"
        ],
        [
            "2019-09-15T09:16:00+03:00",
            "11"
        ],
        [
            "2019-09-15T09:24:00+03:00",
            "24"
        ],
        [
            "2019-09-15T09:32:00+03:00",
            "49"
        ],
        [
            "2019-09-15T09:40:00+03:00",
            "13"
        ],
        [
            "2019-09-15T09:48:00+03:00",
            "13"
        ],
        [
            "2019-09-15T09:56:00+03:00",
            "14"
        ],
        [
            "2019-09-15T10:04:00+03:00",
            "29"
        ],
        [
            "2019-09-15T10:12:00+03:00",
            "31"
        ],
        [
            "2019-09-15T10:20:00+03:00",
            "16"
        ],
        [
            "2019-09-15T10:28:00+03:00",
            "17"
        ],
        [
            "2019-09-15T10:36:00+03:00",
            "0"
        ],
        [
            "2019-09-15T10:44:00+03:00",
            "0"
        ],
        [
            "2019-09-15T10:52:00+03:00",
            "60"
        ],
        [
            "2019-09-15T11:00:00+03:00",
            "19"
        ],
        [
            "2019-09-15T11:08:00+03:00",
            "20"
        ],
        [
            "2019-09-15T11:16:00+03:00",
            "22"
        ],
        [
            "2019-09-15T11:24:00+03:00",
            "0"
        ],
        [
            "2019-09-15T11:32:00+03:00",
            "24"
        ],
        [
            "2019-09-15T11:40:00+03:00",
            "0"
        ],
        [
            "2019-09-15T11:48:00+03:00",
            "0"
        ],
        [
            "2019-09-15T11:56:00+03:00",
            "0"
        ],
        [
            "2019-09-15T12:04:00+03:00",
            "25"
        ],
        [
            "2019-09-15T12:12:00+03:00",
            "0"
        ],
        [
            "2019-09-15T12:20:00+03:00",
            "0"
        ],
        [
            "2019-09-15T12:28:00+03:00",
            "0"
        ],
        [
            "2019-09-15T12:36:00+03:00",
            "100"
        ],
        [
            "2019-09-15T12:44:00+03:00",
            "48"
        ],
        [
            "2019-09-15T12:52:00+03:00",
            "48"
        ],
        [
            "2019-09-15T13:00:00+03:00",
            "0"
        ],
        [
            "2019-09-15T13:08:00+03:00",
            "0"
        ],
        [
            "2019-09-15T13:16:00+03:00",
            "37"
        ],
        [
            "2019-09-15T13:24:00+03:00",
            "18"
        ],
        [
            "2019-09-15T13:32:00+03:00",
            "34"
        ],
        [
            "2019-09-15T13:40:00+03:00",
            "16"
        ],
        [
            "2019-09-15T13:48:00+03:00",
            "15"
        ],
        [
            "2019-09-15T13:56:00+03:00",
            "0"
        ],
        [
            "2019-09-15T14:04:00+03:00",
            "27"
        ],
        [
            "2019-09-15T14:12:00+03:00",
            "0"
        ],
        [
            "2019-09-15T14:20:00+03:00",
            "12"
        ],
        [
            "2019-09-15T14:28:00+03:00",
            "0"
        ],
        [
            "2019-09-15T14:36:00+03:00",
            "21"
        ],
        [
            "2019-09-15T14:44:00+03:00",
            "10"
        ],
        [
            "2019-09-15T14:52:00+03:00",
            "10"
        ],
        [
            "2019-09-15T15:00:00+03:00",
            "9"
        ],
        [
            "2019-09-15T15:08:00+03:00",
            "26"
        ],
        [
            "2019-09-15T15:16:00+03:00",
            "0"
        ],
        [
            "2019-09-15T15:24:00+03:00",
            "39"
        ],
        [
            "2019-09-15T15:32:00+03:00",
            "23"
        ],
        [
            "2019-09-15T15:40:00+03:00",
            "22"
        ],
        [
            "2019-09-15T15:48:00+03:00",
            "13"
        ],
        [
            "2019-09-15T15:56:00+03:00",
            "26"
        ],
        [
            "2019-09-15T16:04:00+03:00",
            "20"
        ],
        [
            "2019-09-15T16:12:00+03:00",
            "25"
        ],
        [
            "2019-09-15T16:20:00+03:00",
            "0"
        ],
        [
            "2019-09-15T16:28:00+03:00",
            "23"
        ],
        [
            "2019-09-15T16:36:00+03:00",
            "39"
        ],
        [
            "2019-09-15T16:44:00+03:00",
            "11"
        ],
        [
            "2019-09-15T16:52:00+03:00",
            "21"
        ],
        [
            "2019-09-15T17:00:00+03:00",
            "10"
        ],
        [
            "2019-09-15T17:08:00+03:00",
            "31"
        ],
        [
            "2019-09-15T17:16:00+03:00",
            "15"
        ]
    ],
    "alphaVantage": {
        "Meta Data": {
            "1. Information": "Intraday (5min) open, high, low, close prices and volume",
            "2. Symbol": "MSFT",
            "3. Last Refreshed": "2019-09-13 16:00:00",
            "4. Interval": "5min",
            "5. Output Size": "Compact",
            "6. Time Zone": "US/Eastern"
        },
        "Time Series (5min)": {
            "2019-09-13 16:00:00": {
                "1. open": "137.2200",
                "2. high": "137.4900",
                "3. low": "137.1500",
                "4. close": "137.2200",
                "5. volume": "1265854"
            },
            "2019-09-13 15:55:00": {
                "1. open": "137.1800",
                "2. high": "137.3600",
                "3. low": "137.1250",
                "4. close": "137.2200",
                "5. volume": "563768"
            },
            "2019-09-13 15:50:00": {
                "1. open": "137.2300",
                "2. high": "137.2800",
                "3. low": "137.1100",
                "4. close": "137.1899",
                "5. volume": "254607"
            },
            "2019-09-13 15:45:00": {
                "1. open": "137.0900",
                "2. high": "137.2390",
                "3. low": "137.0700",
                "4. close": "137.2390",
                "5. volume": "288104"
            },
            "2019-09-13 15:40:00": {
                "1. open": "137.0450",
                "2. high": "137.1500",
                "3. low": "137.0350",
                "4. close": "137.0850",
                "5. volume": "284683"
            },
            "2019-09-13 15:35:00": {
                "1. open": "137.0000",
                "2. high": "137.0410",
                "3. low": "136.9500",
                "4. close": "137.0406",
                "5. volume": "190238"
            },
            "2019-09-13 15:30:00": {
                "1. open": "136.9800",
                "2. high": "137.0200",
                "3. low": "136.9400",
                "4. close": "137.0050",
                "5. volume": "158070"
            },
            "2019-09-13 15:25:00": {
                "1. open": "136.9700",
                "2. high": "136.9900",
                "3. low": "136.8900",
                "4. close": "136.9850",
                "5. volume": "176457"
            },
            "2019-09-13 15:20:00": {
                "1. open": "136.9900",
                "2. high": "137.0100",
                "3. low": "136.9050",
                "4. close": "136.9850",
                "5. volume": "137068"
            },
            "2019-09-13 15:15:00": {
                "1. open": "136.9700",
                "2. high": "137.0700",
                "3. low": "136.9100",
                "4. close": "137.0000",
                "5. volume": "209151"
            },
            "2019-09-13 15:10:00": {
                "1. open": "137.1300",
                "2. high": "137.1600",
                "3. low": "136.9700",
                "4. close": "136.9700",
                "5. volume": "175500"
            },
            "2019-09-13 15:05:00": {
                "1. open": "137.3600",
                "2. high": "137.3670",
                "3. low": "137.1200",
                "4. close": "137.1300",
                "5. volume": "178513"
            },
            "2019-09-13 15:00:00": {
                "1. open": "137.3100",
                "2. high": "137.4200",
                "3. low": "137.3100",
                "4. close": "137.3600",
                "5. volume": "112237"
            },
            "2019-09-13 14:55:00": {
                "1. open": "137.2500",
                "2. high": "137.3900",
                "3. low": "137.2450",
                "4. close": "137.3100",
                "5. volume": "105638"
            },
            "2019-09-13 14:50:00": {
                "1. open": "137.3800",
                "2. high": "137.3800",
                "3. low": "137.1800",
                "4. close": "137.2361",
                "5. volume": "122588"
            },
            "2019-09-13 14:45:00": {
                "1. open": "137.3200",
                "2. high": "137.4800",
                "3. low": "137.3100",
                "4. close": "137.3850",
                "5. volume": "131030"
            },
            "2019-09-13 14:40:00": {
                "1. open": "137.3300",
                "2. high": "137.3400",
                "3. low": "137.2900",
                "4. close": "137.3200",
                "5. volume": "100246"
            },
            "2019-09-13 14:35:00": {
                "1. open": "137.2750",
                "2. high": "137.3650",
                "3. low": "137.2750",
                "4. close": "137.3300",
                "5. volume": "102997"
            },
            "2019-09-13 14:30:00": {
                "1. open": "137.3050",
                "2. high": "137.3201",
                "3. low": "137.1850",
                "4. close": "137.2750",
                "5. volume": "86466"
            },
            "2019-09-13 14:25:00": {
                "1. open": "137.2400",
                "2. high": "137.3250",
                "3. low": "137.2300",
                "4. close": "137.3200",
                "5. volume": "122303"
            },
            "2019-09-13 14:20:00": {
                "1. open": "137.2830",
                "2. high": "137.3000",
                "3. low": "137.2100",
                "4. close": "137.2400",
                "5. volume": "122222"
            },
            "2019-09-13 14:15:00": {
                "1. open": "137.3800",
                "2. high": "137.3800",
                "3. low": "137.2600",
                "4. close": "137.2800",
                "5. volume": "106199"
            },
            "2019-09-13 14:10:00": {
                "1. open": "137.3350",
                "2. high": "137.3850",
                "3. low": "137.3300",
                "4. close": "137.3850",
                "5. volume": "79745"
            },
            "2019-09-13 14:05:00": {
                "1. open": "137.2900",
                "2. high": "137.3872",
                "3. low": "137.2600",
                "4. close": "137.3400",
                "5. volume": "93675"
            },
            "2019-09-13 14:00:00": {
                "1. open": "137.5200",
                "2. high": "137.5300",
                "3. low": "137.2800",
                "4. close": "137.2900",
                "5. volume": "119913"
            },
            "2019-09-13 13:55:00": {
                "1. open": "137.4900",
                "2. high": "137.5300",
                "3. low": "137.4550",
                "4. close": "137.5300",
                "5. volume": "117584"
            },
            "2019-09-13 13:50:00": {
                "1. open": "137.3200",
                "2. high": "137.4800",
                "3. low": "137.2800",
                "4. close": "137.4800",
                "5. volume": "162948"
            },
            "2019-09-13 13:45:00": {
                "1. open": "137.4700",
                "2. high": "137.4750",
                "3. low": "137.2300",
                "4. close": "137.3200",
                "5. volume": "155354"
            },
            "2019-09-13 13:40:00": {
                "1. open": "137.4600",
                "2. high": "137.4800",
                "3. low": "137.3800",
                "4. close": "137.4750",
                "5. volume": "72371"
            },
            "2019-09-13 13:35:00": {
                "1. open": "137.4100",
                "2. high": "137.4700",
                "3. low": "137.3800",
                "4. close": "137.4700",
                "5. volume": "80958"
            },
            "2019-09-13 13:30:00": {
                "1. open": "137.3650",
                "2. high": "137.4200",
                "3. low": "137.3300",
                "4. close": "137.4200",
                "5. volume": "163402"
            },
            "2019-09-13 13:25:00": {
                "1. open": "137.4265",
                "2. high": "137.4300",
                "3. low": "137.3500",
                "4. close": "137.3656",
                "5. volume": "91612"
            },
            "2019-09-13 13:20:00": {
                "1. open": "137.4200",
                "2. high": "137.5800",
                "3. low": "137.4114",
                "4. close": "137.4250",
                "5. volume": "173110"
            },
            "2019-09-13 13:15:00": {
                "1. open": "137.3600",
                "2. high": "137.4300",
                "3. low": "137.3220",
                "4. close": "137.4300",
                "5. volume": "114163"
            },
            "2019-09-13 13:10:00": {
                "1. open": "137.1684",
                "2. high": "137.3900",
                "3. low": "137.1423",
                "4. close": "137.3700",
                "5. volume": "148734"
            },
            "2019-09-13 13:05:00": {
                "1. open": "137.2800",
                "2. high": "137.2800",
                "3. low": "137.1500",
                "4. close": "137.1650",
                "5. volume": "169820"
            },
            "2019-09-13 13:00:00": {
                "1. open": "137.3300",
                "2. high": "137.3700",
                "3. low": "137.2800",
                "4. close": "137.2800",
                "5. volume": "103917"
            },
            "2019-09-13 12:55:00": {
                "1. open": "137.3100",
                "2. high": "137.3900",
                "3. low": "137.2100",
                "4. close": "137.3200",
                "5. volume": "182399"
            },
            "2019-09-13 12:50:00": {
                "1. open": "137.3900",
                "2. high": "137.4200",
                "3. low": "137.3100",
                "4. close": "137.3100",
                "5. volume": "122885"
            },
            "2019-09-13 12:45:00": {
                "1. open": "137.3800",
                "2. high": "137.3900",
                "3. low": "137.3200",
                "4. close": "137.3900",
                "5. volume": "113453"
            },
            "2019-09-13 12:40:00": {
                "1. open": "137.3350",
                "2. high": "137.4500",
                "3. low": "137.3350",
                "4. close": "137.3800",
                "5. volume": "128568"
            },
            "2019-09-13 12:35:00": {
                "1. open": "137.3800",
                "2. high": "137.3800",
                "3. low": "137.2800",
                "4. close": "137.3400",
                "5. volume": "149048"
            },
            "2019-09-13 12:30:00": {
                "1. open": "137.4500",
                "2. high": "137.4600",
                "3. low": "137.3300",
                "4. close": "137.3850",
                "5. volume": "215404"
            },
            "2019-09-13 12:25:00": {
                "1. open": "137.6150",
                "2. high": "137.6150",
                "3. low": "137.4000",
                "4. close": "137.4600",
                "5. volume": "158828"
            },
            "2019-09-13 12:20:00": {
                "1. open": "137.6100",
                "2. high": "137.6200",
                "3. low": "137.5800",
                "4. close": "137.6200",
                "5. volume": "123027"
            },
            "2019-09-13 12:15:00": {
                "1. open": "137.6050",
                "2. high": "137.6290",
                "3. low": "137.5100",
                "4. close": "137.6000",
                "5. volume": "98537"
            },
            "2019-09-13 12:10:00": {
                "1. open": "137.5000",
                "2. high": "137.6800",
                "3. low": "137.4900",
                "4. close": "137.6100",
                "5. volume": "112467"
            },
            "2019-09-13 12:05:00": {
                "1. open": "137.4300",
                "2. high": "137.5000",
                "3. low": "137.4100",
                "4. close": "137.4900",
                "5. volume": "168406"
            },
            "2019-09-13 12:00:00": {
                "1. open": "137.4700",
                "2. high": "137.5700",
                "3. low": "137.4300",
                "4. close": "137.4300",
                "5. volume": "94350"
            },
            "2019-09-13 11:55:00": {
                "1. open": "137.5242",
                "2. high": "137.5950",
                "3. low": "137.4500",
                "4. close": "137.4600",
                "5. volume": "187162"
            },
            "2019-09-13 11:50:00": {
                "1. open": "137.4300",
                "2. high": "137.5300",
                "3. low": "137.3700",
                "4. close": "137.5200",
                "5. volume": "150776"
            },
            "2019-09-13 11:45:00": {
                "1. open": "137.2700",
                "2. high": "137.4300",
                "3. low": "137.2507",
                "4. close": "137.4300",
                "5. volume": "181686"
            },
            "2019-09-13 11:40:00": {
                "1. open": "137.3600",
                "2. high": "137.3900",
                "3. low": "137.2300",
                "4. close": "137.2700",
                "5. volume": "196163"
            },
            "2019-09-13 11:35:00": {
                "1. open": "137.3600",
                "2. high": "137.4400",
                "3. low": "137.3500",
                "4. close": "137.3500",
                "5. volume": "161552"
            },
            "2019-09-13 11:30:00": {
                "1. open": "137.7600",
                "2. high": "137.8000",
                "3. low": "137.3300",
                "4. close": "137.3700",
                "5. volume": "364613"
            },
            "2019-09-13 11:25:00": {
                "1. open": "137.8200",
                "2. high": "137.8800",
                "3. low": "137.7400",
                "4. close": "137.7550",
                "5. volume": "188620"
            },
            "2019-09-13 11:20:00": {
                "1. open": "137.8500",
                "2. high": "137.9000",
                "3. low": "137.8000",
                "4. close": "137.8150",
                "5. volume": "174272"
            },
            "2019-09-13 11:15:00": {
                "1. open": "137.9800",
                "2. high": "137.9800",
                "3. low": "137.8600",
                "4. close": "137.9400",
                "5. volume": "124185"
            },
            "2019-09-13 11:10:00": {
                "1. open": "137.8700",
                "2. high": "138.0550",
                "3. low": "137.8650",
                "4. close": "137.9900",
                "5. volume": "239636"
            },
            "2019-09-13 11:05:00": {
                "1. open": "137.7600",
                "2. high": "137.9200",
                "3. low": "137.7550",
                "4. close": "137.8700",
                "5. volume": "164275"
            },
            "2019-09-13 11:00:00": {
                "1. open": "137.9400",
                "2. high": "137.9700",
                "3. low": "137.7500",
                "4. close": "137.7600",
                "5. volume": "181105"
            },
            "2019-09-13 10:55:00": {
                "1. open": "137.9401",
                "2. high": "137.9900",
                "3. low": "137.8450",
                "4. close": "137.9400",
                "5. volume": "199917"
            },
            "2019-09-13 10:50:00": {
                "1. open": "137.8500",
                "2. high": "137.9300",
                "3. low": "137.8300",
                "4. close": "137.9250",
                "5. volume": "172749"
            },
            "2019-09-13 10:45:00": {
                "1. open": "137.8300",
                "2. high": "137.9050",
                "3. low": "137.8000",
                "4. close": "137.8400",
                "5. volume": "199441"
            },
            "2019-09-13 10:40:00": {
                "1. open": "137.7500",
                "2. high": "137.8400",
                "3. low": "137.5750",
                "4. close": "137.8400",
                "5. volume": "307765"
            },
            "2019-09-13 10:35:00": {
                "1. open": "137.7800",
                "2. high": "137.9200",
                "3. low": "137.7300",
                "4. close": "137.7500",
                "5. volume": "373889"
            },
            "2019-09-13 10:30:00": {
                "1. open": "137.5800",
                "2. high": "137.8400",
                "3. low": "137.5600",
                "4. close": "137.7800",
                "5. volume": "291045"
            },
            "2019-09-13 10:25:00": {
                "1. open": "137.4900",
                "2. high": "137.6370",
                "3. low": "137.4900",
                "4. close": "137.5750",
                "5. volume": "261406"
            },
            "2019-09-13 10:20:00": {
                "1. open": "137.1550",
                "2. high": "137.4800",
                "3. low": "137.1431",
                "4. close": "137.4800",
                "5. volume": "274474"
            },
            "2019-09-13 10:15:00": {
                "1. open": "137.1127",
                "2. high": "137.2500",
                "3. low": "137.0500",
                "4. close": "137.1577",
                "5. volume": "248241"
            },
            "2019-09-13 10:10:00": {
                "1. open": "137.1957",
                "2. high": "137.4021",
                "3. low": "137.1118",
                "4. close": "137.1157",
                "5. volume": "226755"
            },
            "2019-09-13 10:05:00": {
                "1. open": "137.3700",
                "2. high": "137.4600",
                "3. low": "137.1400",
                "4. close": "137.1700",
                "5. volume": "260321"
            },
            "2019-09-13 10:00:00": {
                "1. open": "137.4500",
                "2. high": "137.4900",
                "3. low": "137.2900",
                "4. close": "137.3700",
                "5. volume": "298955"
            },
            "2019-09-13 09:55:00": {
                "1. open": "137.1200",
                "2. high": "137.5400",
                "3. low": "137.1200",
                "4. close": "137.4400",
                "5. volume": "402399"
            },
            "2019-09-13 09:50:00": {
                "1. open": "137.1000",
                "2. high": "137.1500",
                "3. low": "137.0460",
                "4. close": "137.1100",
                "5. volume": "295406"
            },
            "2019-09-13 09:45:00": {
                "1. open": "136.8051",
                "2. high": "137.2500",
                "3. low": "136.8000",
                "4. close": "137.1051",
                "5. volume": "478567"
            },
            "2019-09-13 09:40:00": {
                "1. open": "137.0705",
                "2. high": "137.1500",
                "3. low": "136.7200",
                "4. close": "136.8065",
                "5. volume": "618521"
            },
            "2019-09-13 09:35:00": {
                "1. open": "137.7300",
                "2. high": "137.7600",
                "3. low": "137.0500",
                "4. close": "137.0600",
                "5. volume": "817381"
            },
            "2019-09-12 16:00:00": {
                "1. open": "137.8500",
                "2. high": "137.8600",
                "3. low": "137.5000",
                "4. close": "137.5400",
                "5. volume": "1182908"
            },
            "2019-09-12 15:55:00": {
                "1. open": "137.9050",
                "2. high": "137.9600",
                "3. low": "137.7650",
                "4. close": "137.8450",
                "5. volume": "559199"
            },
            "2019-09-12 15:50:00": {
                "1. open": "137.9250",
                "2. high": "137.9800",
                "3. low": "137.9100",
                "4. close": "137.9100",
                "5. volume": "352803"
            },
            "2019-09-12 15:45:00": {
                "1. open": "138.0900",
                "2. high": "138.0900",
                "3. low": "137.8900",
                "4. close": "137.9250",
                "5. volume": "323166"
            },
            "2019-09-12 15:40:00": {
                "1. open": "138.0600",
                "2. high": "138.1800",
                "3. low": "138.0500",
                "4. close": "138.0950",
                "5. volume": "234875"
            },
            "2019-09-12 15:35:00": {
                "1. open": "138.0000",
                "2. high": "138.1700",
                "3. low": "137.9600",
                "4. close": "138.0650",
                "5. volume": "221781"
            },
            "2019-09-12 15:30:00": {
                "1. open": "138.1000",
                "2. high": "138.1000",
                "3. low": "137.9800",
                "4. close": "137.9900",
                "5. volume": "125195"
            },
            "2019-09-12 15:25:00": {
                "1. open": "137.9700",
                "2. high": "138.1500",
                "3. low": "137.9600",
                "4. close": "138.1000",
                "5. volume": "198700"
            },
            "2019-09-12 15:20:00": {
                "1. open": "138.0300",
                "2. high": "138.0400",
                "3. low": "137.9500",
                "4. close": "137.9800",
                "5. volume": "134751"
            },
            "2019-09-12 15:15:00": {
                "1. open": "138.0841",
                "2. high": "138.0950",
                "3. low": "138.0120",
                "4. close": "138.0359",
                "5. volume": "122735"
            },
            "2019-09-12 15:10:00": {
                "1. open": "138.0850",
                "2. high": "138.0900",
                "3. low": "138.0100",
                "4. close": "138.0900",
                "5. volume": "168871"
            },
            "2019-09-12 15:05:00": {
                "1. open": "138.2100",
                "2. high": "138.2200",
                "3. low": "138.0700",
                "4. close": "138.0850",
                "5. volume": "193112"
            },
            "2019-09-12 15:00:00": {
                "1. open": "138.2500",
                "2. high": "138.2600",
                "3. low": "138.1800",
                "4. close": "138.2000",
                "5. volume": "160687"
            },
            "2019-09-12 14:55:00": {
                "1. open": "138.2100",
                "2. high": "138.2800",
                "3. low": "138.2050",
                "4. close": "138.2500",
                "5. volume": "121298"
            },
            "2019-09-12 14:50:00": {
                "1. open": "138.2300",
                "2. high": "138.2550",
                "3. low": "138.1548",
                "4. close": "138.2000",
                "5. volume": "87268"
            },
            "2019-09-12 14:45:00": {
                "1. open": "138.1900",
                "2. high": "138.3200",
                "3. low": "138.1820",
                "4. close": "138.2200",
                "5. volume": "167969"
            },
            "2019-09-12 14:40:00": {
                "1. open": "138.1971",
                "2. high": "138.2000",
                "3. low": "138.1700",
                "4. close": "138.1800",
                "5. volume": "149854"
            },
            "2019-09-12 14:35:00": {
                "1. open": "138.1400",
                "2. high": "138.1950",
                "3. low": "138.0900",
                "4. close": "138.1900",
                "5. volume": "141861"
            },
            "2019-09-12 14:30:00": {
                "1. open": "138.0800",
                "2. high": "138.1500",
                "3. low": "138.0800",
                "4. close": "138.1400",
                "5. volume": "88357"
            },
            "2019-09-12 14:25:00": {
                "1. open": "138.0600",
                "2. high": "138.1000",
                "3. low": "138.0400",
                "4. close": "138.0850",
                "5. volume": "110210"
            },
            "2019-09-12 14:20:00": {
                "1. open": "138.0900",
                "2. high": "138.1150",
                "3. low": "138.0300",
                "4. close": "138.0550",
                "5. volume": "115507"
            },
            "2019-09-12 14:15:00": {
                "1. open": "138.0650",
                "2. high": "138.1600",
                "3. low": "138.0500",
                "4. close": "138.0998",
                "5. volume": "95807"
            }
        }
    }
}
  public lineChartData: ChartDataSets[] = [];
  public lineChartLabels: Label[] = [];
  public lineChartOptions: (ChartOptions & { annotation: any }) = {
    responsive: true,
    scales: {
      // We use this empty structure as a placeholder for dynamic theming.
      xAxes: [{}],
      yAxes: [
        {
          id: 'y-axis-0',
          position: 'left',
        },
        {
          id: 'y-axis-1',
          position: 'right',
          gridLines: {
            color: 'rgba(255,0,0,0.3)',
          },
          ticks: {
            fontColor: 'red',
          }
        }
      ]
    },
    annotation: {
      annotations: [
        {
          type: 'line',
          mode: 'vertical',
          scaleID: 'x-axis-0',
          value: 'March',
          borderColor: 'orange',
          borderWidth: 2,
          label: {
            enabled: true,
            fontColor: 'orange',
            content: 'LineAnno'
          }
        },
      ],
    },
  };
  public lineChartColors: Color[] = [
    { // grey
      backgroundColor: 'rgba(148,159,177,0.2)',
      borderColor: 'rgba(148,159,177,1)',
      pointBackgroundColor: 'rgba(148,159,177,1)',
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: 'rgba(148,159,177,0.8)'
    },
    { // dark grey
      backgroundColor: 'rgba(77,83,96,0.2)',
      borderColor: 'rgba(77,83,96,1)',
      pointBackgroundColor: 'rgba(77,83,96,1)',
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: 'rgba(77,83,96,1)'
    },
    { // red
      backgroundColor: 'rgba(255,0,0,0.3)',
      borderColor: 'red',
      pointBackgroundColor: 'rgba(148,159,177,1)',
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: 'rgba(148,159,177,0.8)'
    }
  ];
  public lineChartLegend = true;
  public lineChartType = 'line';
  public lineChartPlugins = [pluginAnnotations];

  @ViewChild(BaseChartDirective, { static: true }) chart: BaseChartDirective;

  constructor() { }

  ngOnInit() {
    this.formatChart(this.data);
  }

  formatGoogleTrends(original: Array<any>): any {
    return _.map(_.drop(original, 1), (item) => {
      return {
        date: moment(_.get(item, ['0'])).toDate(),
        searchVolume: _.toNumber(_.get(item, ['1'])),
        type: 'googleTrends'
      }
    });
  }

  formatAlphaVantage(original: any): any {
    return _.map(_.get(original, ['Time Series (5min)']), (info, time) => {
        return {
          date: moment(time, 'YYYY-MM-DD HH:mm:ss').toDate(),
          volume: _.toNumber(_.get(info, ['5. volume'])),
          type: 'alphaVantage'
        }
    });
  }

  formatValues(combinedData: Array<any>, type: string, field: string): Array<any> {
    /*
      original: [9:04]
      input: [9:00, 9:04, 9:05]
      output: [0, 100, 100]
    */
   let previous = 0;
   return _.map(combinedData, (item, index) => {
     const isType = _.isEqual(_.get(item, ['type']), type);
     if (_.isEqual(index, 0) && !isType) {
       return previous;
     }
     if (isType) {
       const current = _.get(item, [field]);
       previous = current;
       return current;
     } else {
       return previous;
     }
   });
  }

  formatChart(data: any): void {
    const formattedGoogleTrends = this.formatGoogleTrends(_.get(data, ['googleTrends']));
    const formattedAlphaVantage = this.formatAlphaVantage(_.get(data, ['alphaVantage']));
    const combinedData = _.orderBy(
      _.concat(formattedGoogleTrends, formattedAlphaVantage),
      [item => moment(_.get(item, ['date']))], ['asc']
    );
    const finalLabels = _.union(_.map(combinedData, (item) => {
      return moment(_.get(item, ['date'])).format('LLL');
    }));

    this.lineChartData = [
      {
        data: this.formatValues(combinedData, 'googleTrends', 'searchVolume'),
        label: 'Google Trends',
        yAxisID: 'y-axis-1'
      },
      {
        data: this.formatValues(combinedData, 'alphaVantage', 'volume'),
        label: 'AlphaVantage'
      }
    ]
    this.lineChartLabels = finalLabels;
  }

  // events
  public chartClicked({ event, active }: { event: MouseEvent, active: {}[] }): void {
    console.log(event, active);
  }

  public chartHovered({ event, active }: { event: MouseEvent, active: {}[] }): void {
    console.log(event, active);
  }

  public hideOne() {
    const isHidden = this.chart.isDatasetHidden(1);
    this.chart.hideDataset(1, !isHidden);
  }

  public changeColor() {
    this.lineChartColors[2].borderColor = 'green';
    this.lineChartColors[2].backgroundColor = `rgba(0, 255, 0, 0.3)`;
  }

  public changeLabel() {
    this.lineChartLabels[2] = ['1st Line', '2nd Line'];
    // this.chart.update();
  }
}
